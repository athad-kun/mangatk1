# تقرير التقنيات المستخدمة وتصميم قاعدة البيانات الجديد

هذا المستند يحتوي على:
1.  **تقرير التقنيات:** شرح تفصيلي للأدوات المستخدمة في الباك إند.
2.  **تفاصيل منطق العمل (Business Logic):** شرح دقيق لنظام النقاط والاشتراكات.
3.  **تصميم قاعدة البيانات (ER Diagram):** المخطط الكامل والشامل.

---

## 1. تقرير التقنيات المستخدمة في الباك إند

في بناء هذا المشروع، اعتمدنا على مجموعة من التقنيات القوية لضمان الأداء والقابلية للتوسع.

### 1. لغة البرمجة: Python
*   **التعريف:** لغة برمجة عالية المستوى، متعددة الأغراض، وسهلة القراءة.
*   **الاستخدام:** كتابة منطق السيرفر (Server-side logic) بالكامل.
*   **لماذا تم اختيارها:** 
    *   لأنها "اللغة الأم" للذكاء الاصطناعي (AI). بما أننا سنضيف ميزة "ترجمة الفصول بالذكاء الاصطناعي"، فإن استخدام Python يسهل التعامل مع المكتبات والنماذج مباشرة في المستقبل.
    *   إنتاجية عالية وسرعة في كتابة الكود مقارنة بـ Java أو C++.

### 2. إطار العمل: Django
*   **التعريف:** إطار عمل ويب (Web Framework) متكامل "Batteries-included".
*   **الاستخدام:** إدارة قاعدة البيانات (ORM)، نظام المستخدمين والمصادقة (Auth)، ولوحة تحكم الإدارة (Admin).
*   **لماذا تم اختيارها:**
    *   يوفر حماية أمنية افتراضية قوية (CSRF, SQL Injection, XSS).
    *   نظام ORM قوي يسهل التعامل مع قاعدة البيانات دون كتابة SQL يدوياً.
    *   لوحة تحكم (Admin Panel) جاهزة توفر علينا وقتاً طويلاً في بناء أدوات للمشرفين.

### 3. واجهة برمجة التطبيقات: Django REST Framework (DRF)
*   **التعريف:** مكتبة لبناء Web APIs احترافية فوق Django.
*   **الاستخدام:** تحويل البيانات إلى JSON لإرسالها للفرونت إند (React).
*   **لماذا تم اختيارها:** توفر أدوات مدمجة للت Serializers (تحويل البيانات)، والمصادقة (Authentication)، والتحكم في الصلاحيات (Permissions) بشكل معياري ومستقر.

### 4. قاعدة البيانات: SQLite (للتطوير) / PostgreSQL (للإنتاج)
*   **التعريف:** قاعدة بيانات علائقية (Relational Database).
*   **الاستخدام:** تخزين المستخدمين، المانجا، الفصول، والنقاط.
*   **لماذا تم اختيارها:** SQLite ممتازة وسريعة للتطوير المحلي (ملف واحد). عند الإطلاق الفعلي، Django يسمح بالانتقال لـ PostgreSQL (الأقوى للأحمال العالية) بتغيير سطر واحد فقط في الإعدادات.

### 5. معالجة الصور: Pillow (PIL)
*   **التعريف:** مكتبة بايثون لمعالجة الصور.
*   **الاستخدام:** فحص الملفات المرفوعة للتأكد من أنها صور وليست ملفات خبيثة، وتغيير حجم الصور.
*   **لماذا تم اختيارها:** المعيار القياسي في بايثون، وتدعم جميع الصيغ (JPG, PNG, WEBP).

### 6. التخزين الخارجي: ImgBB Cloud Storage
*   **التعريف:** خدمة سحابية لتخزين الصور.
*   **الاستخدام:** تخزين صور الفصول بعيداً عن السيرفر الرئيسي.
*   **لماذا تم اختيارها:** لتقليل تكلفة الاستضافة (Bandwidth/Storage) وتسريع تحميل الصور للمستخدمين عبر شبكات CDN العالمية الخاصة بهم.

### 7. إدارة المهام الخلفية (Background Tasks): Celery + Redis (مقترح للإضافة)
*   **التعريف:** أدوات لإدارة المهام التي تستغرق وقتاً طويلاً.
*   **الاستخدام:** معالجة طلبات الترجمة. عندما يرفع المستخدم ملفاً، يقوم Celery باستلامه وفك ضغطه وترجمته في الخلفية بينما يكمل المستخدم تصفح الموقع.
*   **لماذا تم اختيارها:** ضرورية جداً لميزة الترجمة، لأن عملية الترجمة قد تستغرق دقائق، ولا يمكن إبقاء المستخدم منتظراً في المتصفح كل هذا الوقت.

---

## 2. تفاصيل منطق العمل الجديد (Business Logic)

بناءً على طلبك، تم تصميم هيكل البيانات ليدعم الأنظمة التالية بدقة:

### أ. نظام الاشتراكات (Tiered Subscriptions)
سيكون هناك جدول `SubscriptionTier` يحتوي على 3 خطط رئيسية:
1.  **المجاني (Free):**
    *   معدل كسب نقاط طبيعي (x1).
    *   يحتوي على إعلانات.
2.  **المتوسط (Standard):**
    *   معدل كسب نقاط أعلى (مثلاً x1.5).
    *   إعلانات أقل أو معدومة.
3.  **الفاخر (Premium/Alpha):**
    *   أعلى معدل كسب نقاط (x2).
    *   بدون إعلانات تماماً.
    *   أولوية في طابور الترجمة.

### ب. نظام النقاط (Points System)
*   **نقاط التسجيل:** يمنح المستخدم الجديد رصيداً أولياً (مثلاً 500 نقطة) يكفي لترجمة 5 فصول.
*   **المكافآت:** عند قراءة فصل كامل (يتم تتبع التقدم في `ReadingHistory`)، يتم منح نقاط صغيرة (مثلاً 10 نقاط).
*   **الصرف:** يتم خصم النقاط عند طلب "ترجمة فصل". تكلفة الترجمة تعتمد على عدد الصور في الفصل.

---

## 3. مخطط العلاقات الكامل (ER Diagram)

المخطط التالي يوضح العلاقات بين الجداول باستخدام الرسم التوضيحي (ASCII Art) لتسهيل القراءة:

```
                            ┌────────────────────────┐
                            │    SubscriptionTier    │
                            │ (Free, Standard, ...)  │
                            └────────────▲───────────┘
                                         │
                                         │ 1:M (User belongs to one Tier)
                                         │
            ┌──────────────────┐         │
            │ PointTransaction │◄────────┤
            └──────────────────┘         │
                     ▲                   │
                     │ 1:M               │
                     │                   │
            ┌──────────────────┐  ┌──────┴──────┐   ┌──────────────────┐
            │   Notification   │◄─┤    User     │──►│TranslationRequest│
            └──────────────────┘  └──────┬──────┘   └────────┬─────────┘
                                         │                   │
                                         │ 1:M               │ M:1
                   ┌─────────────────────┼───────────────────┤
                   │                     │                   │
                   ▼                     ▼                   ▼
           ┌────────────────┐    ┌────────────────┐  ┌─────────────────┐
           │ ReadingHistory │◄───┤    Comment     │  │ AIServiceConfig │
           └───────┬────────┘    └────────────────┘  │ (GPT-4, Claude) │
                   │                                 └─────────────────┘
                   │ M:1
                   ▼
           ┌────────────────┐
           │    Chapter     │
           └───────┬────────┘
                   │
                   │ M:1
                   ▼
           ┌────────────────┐
           │     Manga      │
           └────────────────┘
```

### شرح العلاقات:

1.  **User ↔ SubscriptionTier**: كل مستخدم يملك اشتراكاً واحداً (أو لا شيء).
2.  **User ↔ PointTransaction**: المستخدم لديه سجل طويل من عمليات كسب/صرف النقاط.
3.  **User ↔ TranslationRequest**: المستخدم يرسل طلبات ترجمة متعددة.
4.  **TranslationRequest ↔ AIServiceConfig**: كل طلب ترجمة تتم معالجته بواسطة خدمة ذكاء اصطناعي محددة.
5.  **User ↔ ReadingHistory**: سجل قراءة المستخدم للفصول.
6.  **ReadingHistory ↔ Chapter**: كل سجل مرتبط بفصل محدد.
